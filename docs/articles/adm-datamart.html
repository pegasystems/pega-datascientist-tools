<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>adm-datamart • cdhtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="adm-datamart">
<meta property="og:description" content="cdhtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cdhtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/adhoc-datasetanalysis.html">adhoc-datasetanalysis</a>
    </li>
    <li>
      <a href="../articles/adm-datamart.html">adm-datamart</a>
    </li>
    <li>
      <a href="../articles/adm-explained.html">adm-explained</a>
    </li>
    <li>
      <a href="../articles/historical-dataset.html">historical-dataset</a>
    </li>
    <li>
      <a href="../articles/ih-reporting.html">ih-reporting</a>
    </li>
    <li>
      <a href="../articles/snapshots-to-scorecards.html">snapshots-to-scorecards</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="adm-datamart_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>adm-datamart</h1>
                        <h4 class="author">Pega</h4>
            
            <h4 class="date">2021-10-05</h4>
      
      
      <div class="hidden name"><code>adm-datamart.Rmd</code></div>

    </div>

    
    
<div id="adm-datamart" class="section level1">
<h1 class="hasAnchor">
<a href="#adm-datamart" class="anchor"></a>ADM Datamart</h1>
<p>The ADM Datamart is an open database schema where the ADM models and all predictors are copied into. The standard ADM reports both in Analytics Center as well as in the Report Browser (Adaptive category) work off this schema.</p>
<p>Since the schema is open we can easily use it to create our own reports and support measurements and plots not available in the OOTB reporting in Pega.</p>
</div>
<div id="data-loading" class="section level1">
<h1 class="hasAnchor">
<a href="#data-loading" class="anchor"></a>Data Loading</h1>
<p>Let’s first load the data. An example export is provided with the package. Ways to load your own data from the database or from a dataset export will be described later.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">cdhtools</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">admdatamart_models</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">admdatamart_binning</span><span class="op">)</span></code></pre></div>
<div id="data-loading-using-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#data-loading-using-datasets" class="anchor"></a>Data Loading using Datasets</h2>
<p>To load your own data, export the datasets from Pega, download them to your filesystem and let the <code>cdhtools</code> library import it. In order to be able to process the data universally we also make sure to make the names lower case and make sure the types are as expected by the snippets that follow below. This would also be a good place to zoom in to specific models relevant to your application.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">admdatamart_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readADMDatamartModelExport.html">readADMDatamartModelExport</a></span><span class="op">(</span><span class="st">"~/Downloads"</span><span class="op">)</span>
<span class="va">admdatamart_binning</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readADMDatamartPredictorExport.html">readADMDatamartPredictorExport</a></span><span class="op">(</span><span class="st">"~/Downloads"</span>, noBinning <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></code></pre></div>
<p>The data may contain multiple snapshots. For this notebook, we have explicit variables with and without this trend information. Normally you would pass an option to keep all snapshots or not when reading the data, or configure it in Pega to store it in the first place.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">admdatamart_models_latest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latestSnapshotsOnly.html">latestSnapshotsOnly</a></span><span class="op">(</span><span class="va">admdatamart_models</span><span class="op">)</span>
<span class="va">admdatamart_binning_latest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/latestSnapshotsOnly.html">latestSnapshotsOnly</a></span><span class="op">(</span><span class="va">admdatamart_binning</span><span class="op">)</span></code></pre></div>
</div>
<div id="data-loading-directly-from-the-database" class="section level2">
<h2 class="hasAnchor">
<a href="#data-loading-directly-from-the-database" class="anchor"></a>Data Loading directly from the database</h2>
<p>If you have database access you can also load the data directly from the DB. All you need is a JDBC driver and the proper credentials.</p>
</div>
</div>
<div id="detailed-reports" class="section level1">
<h1 class="hasAnchor">
<a href="#detailed-reports" class="anchor"></a>Detailed Reports</h1>
<p>With the data loaded, we can start with a plot similar to what the Analytics Center provides OOTB, however here we have more flexibility to slice &amp; dice.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMPerformanceSuccessRateBubbleChart.html">plotADMPerformanceSuccessRateBubbleChart</a></span><span class="op">(</span><span class="va">admdatamart_models_latest</span>, facets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Issue"</span>, <span class="st">"Channel"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Performance"</span><span class="op">)</span> <span class="op">+</span>  
  <span class="fu">geom_vline</span><span class="op">(</span>xintercept<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">52</span>,<span class="fl">90</span><span class="op">)</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-4-1.png" width="768" style="display: block; margin: auto;"></p>
<p>We can zoom in into the performance and success rates of the various channels. Here you see that success rates for e-mail are low, as is the average model performance.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMPerformanceSuccessRateBoxPlot.html">plotADMPerformanceSuccessRateBoxPlot</a></span><span class="op">(</span><span class="va">admdatamart_models_latest</span>, <span class="st">"Channel"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_x_continuous</span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">50</span>, <span class="fl">70</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Performance"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-5-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The below plot shows the predictor performance across the selected models. It is similar to one of the reports in the set of out of the box reports available through the Report Browser (“Adaptive” category), however that one does not do a weighted average of the performance. This one does, so gives a more accurate picture.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMPredictorPerformance.html">plotADMPredictorPerformance</a></span><span class="op">(</span><span class="va">admdatamart_binning</span>, <span class="va">admdatamart_models_latest</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu">scale_fill_discrete_sequential</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"SunsetDark"</span><span class="op">)</span> <span class="op">+</span>
        <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span>, strip.text <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">8</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-6-1.png" width="864" style="display: block; margin: auto;"></p>
<p>You could also show the predictor performance in one plot across all predictors for all the selected models. Also arranging by performance in both dimensions gives a quick visual clue of which predictors and which models need attention.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMPredictorPerformanceMatrix.html">plotADMPredictorPerformanceMatrix</a></span><span class="op">(</span><span class="va">admdatamart_binning_latest</span>, <span class="va">admdatamart_models_latest</span>, 
                                  aggregation<span class="op">=</span><span class="st">"Name"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,
        axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span>, angle <span class="op">=</span> <span class="fl">45</span>, hjust <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-7-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="alternative-performance-metrics" class="section level1">
<h1 class="hasAnchor">
<a href="#alternative-performance-metrics" class="anchor"></a>Alternative Performance Metrics</h1>
<p>With all the data available in the datamart, you are not restricted to just reporting. Using the binning information for all of the predictors, you could, for example, calculate the KS score of the models. The KS (Kolmogorov–Smirnov) score is related to the AUC that we use by default, but instead of the areas under the ROC curve, it gives the maximum separation between the true positive and false positive rate.</p>
<p>The below snippet calculates the KS score for all predictors of all propositions and shows them next to AUC reported by ADM.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">admdatamart_binning_latest</span><span class="op">[</span> , <span class="va">Propensity</span> <span class="op">:=</span> <span class="va">BinPositives</span><span class="op">/</span><span class="op">(</span><span class="va">BinPositives</span><span class="op">+</span><span class="va">BinNegatives</span><span class="op">)</span><span class="op">]</span>
<span class="fu">setorder</span><span class="op">(</span><span class="va">admdatamart_binning_latest</span>,<span class="va">Propensity</span><span class="op">)</span>
<span class="va">myKS</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">binning</span><span class="op">)</span>
<span class="op">{</span>
  <span class="va">Goods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinNegatives</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinNegatives</span><span class="op">)</span>
  <span class="va">Bads</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html">cumsum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinPositives</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">binning</span><span class="op">$</span><span class="va">BinPositives</span><span class="op">)</span>
  <span class="va">KS</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">Goods</span> <span class="op">-</span> <span class="va">Bads</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">KS</span><span class="op">)</span>,<span class="fl">0</span>,<span class="va">KS</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>
<span class="va">performanceSummary</span> <span class="op">&lt;-</span> 
  <span class="fu">left_join</span><span class="op">(</span><span class="va">admdatamart_binning_latest</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span>KS <span class="op">=</span> <span class="fu">myKS</span><span class="op">(</span><span class="va">.SD</span><span class="op">)</span>,
                                    auc <span class="op">=</span> <span class="fu">first</span><span class="op">(</span><span class="va">Performance</span><span class="op">)</span><span class="op">)</span>, 
                                by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ModelID"</span>, <span class="st">"PredictorName"</span>,<span class="st">"EntryType"</span><span class="op">)</span><span class="op">]</span>,
            <span class="va">admdatamart_models_latest</span>,
            by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ModelID"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Show KS numbers</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">performanceSummary</span><span class="op">[</span><span class="va">KS</span> <span class="op">&gt;</span> <span class="fl">0.01</span><span class="op">]</span>, 
       <span class="fu">aes</span><span class="op">(</span><span class="va">Name</span>, <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">PredictorName</span>,
                        levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="va">performanceSummary</span><span class="op">$</span><span class="va">PredictorName</span>,decreasing <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>, <span class="st">"Classifier"</span><span class="op">)</span>,<span class="st">"Classifier"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_raster</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill<span class="op">=</span><span class="op">(</span><span class="va">EntryType</span><span class="op">==</span><span class="st">"Classifier"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x<span class="op">=</span><span class="st">""</span>,y<span class="op">=</span><span class="st">""</span>,title<span class="op">=</span><span class="st">"Kolmogorov–Smirnov scores"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">geom_text</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>label<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span><span class="st">"%.2f%%"</span>,<span class="fl">100</span><span class="op">*</span><span class="va">KS</span><span class="op">)</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">guides</span><span class="op">(</span>fill<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">theme</span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span>,
        axis.text.y <span class="op">=</span> <span class="fu">element_text</span><span class="op">(</span>size<span class="op">=</span><span class="fl">6</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu">scale_x_discrete</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"top"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-8-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="gains-and-lift-charts" class="section level1">
<h1 class="hasAnchor">
<a href="#gains-and-lift-charts" class="anchor"></a>Gains and Lift Charts</h1>
<p>In the product models are represented by a score distribution plot like below</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model</span> <span class="op">&lt;-</span> <span class="va">admdatamart_binning_latest</span><span class="op">[</span><span class="va">ModelID</span> <span class="op">%in%</span> <span class="va">admdatamart_models_latest</span><span class="op">[</span><span class="va">Name</span><span class="op">==</span><span class="st">"FirstMortgage"</span><span class="op">]</span><span class="op">$</span><span class="va">ModelID</span><span class="op">]</span>

<span class="fu"><a href="../reference/plotADMBinning.html">plotADMBinning</a></span><span class="op">(</span><span class="va">model</span><span class="op">[</span><span class="va">EntryType</span> <span class="op">==</span> <span class="st">"Classifier"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>, subtitle <span class="op">=</span> <span class="st">"Classifier"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-9-1.png" width="480" style="display: block; margin: auto;"></p>
<p>The same data can be represented as a cumulative gains chart, which indicates the percentage of positive responses as a function of the size of the population targeted.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMCumulativeGains.html">plotADMCumulativeGains</a></span> <span class="op">(</span><span class="va">model</span><span class="op">[</span><span class="va">EntryType</span> <span class="op">==</span> <span class="st">"Classifier"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>, subtitle <span class="op">=</span> <span class="st">"Cumulative Gains"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-10-1.png" width="480" style="display: block; margin: auto;"></p>
<p>A similar view is given by the cumulative lift graphs. This gives insight into what percentage of the customers should be targeted by the models to achieve a certain lift in response rates. Both plots are included in the off-line model reports.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMCumulativeLift.html">plotADMCumulativeLift</a></span> <span class="op">(</span><span class="va">model</span><span class="op">[</span><span class="va">EntryType</span> <span class="op">==</span> <span class="st">"Classifier"</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggtitle</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">model</span><span class="op">$</span><span class="va">Name</span><span class="op">)</span>, collapse<span class="op">=</span><span class="st">","</span><span class="op">)</span>, subtitle <span class="op">=</span> <span class="st">"Lift"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-11-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="sensitity-analysis" class="section level1">
<h1 class="hasAnchor">
<a href="#sensitity-analysis" class="anchor"></a>Sensitity Analysis</h1>
<p>Showing the overall predictor contributions to the models. Behind the scenes the ADM models are translated to score cards, and the weights of all score card elements are used to determine the overall weight of the predictors.</p>
<p>Here we “facet” by model rule (ConfigurationName) but you can also leave this out or facet by e.g. Channel or Issue.</p>
<p>The provided plot function is fairly trivial. For simple use cases it will be sufficient and the plot can still be decorated using standard ggplot constructs as shown.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">varimp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/admVarImp.html">admVarImp</a></span><span class="op">(</span><span class="va">admdatamart_models_latest</span>, <span class="va">admdatamart_binning</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ConfigurationName"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotADMVarImp.html">plotADMVarImp</a></span><span class="op">(</span><span class="va">varimp</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">scale_fill_viridis_c</span><span class="op">(</span>begin<span class="op">=</span><span class="fl">0.5</span>, end<span class="op">=</span><span class="fl">0.9</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-12-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div id="trend-charts" class="section level1">
<h1 class="hasAnchor">
<a href="#trend-charts" class="anchor"></a>Trend charts</h1>
<p>Out of the box, model data is stored over time. This allows trend charts to be created for the performance of models.</p>
<p>The below plots nicely show how the models ramp up over the course of a few hours. We aggregate up to Group level to avoid having too many lines in the plot.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotADMModelPerformanceOverTime.html">plotADMModelPerformanceOverTime</a></span><span class="op">(</span><span class="va">admdatamart_models</span>, aggregation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Issue"</span>, <span class="st">"Group"</span><span class="op">)</span>, facets <span class="op">=</span> <span class="st">"Channel"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-13-1.png" width="672" style="display: block; margin: auto;"></p>
<p>All the plotting functions are fairly straightforward and built on <em>ggplot</em> and <em>data.table</em>. When there is no standard supporting plot function, it is easy enough to write your own. For example, to show the performance of the Age predictor over time and across all models.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">predictorPerformanceTrend</span> <span class="op">&lt;-</span> <span class="va">admdatamart_binning</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html">startsWith</a></span><span class="op">(</span><span class="va">PredictorName</span>, <span class="st">"Customer.A"</span><span class="op">)</span> <span class="op">&amp;</span> <span class="va">BinIndex</span> <span class="op">==</span> <span class="fl">1</span>, <span class="fu">.</span><span class="op">(</span>Performance <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Performance</span><span class="op">)</span><span class="op">)</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SnapshotTime"</span>,<span class="st">"PredictorName"</span><span class="op">)</span><span class="op">]</span>

<span class="fu">ggplot</span><span class="op">(</span><span class="va">predictorPerformanceTrend</span>, <span class="fu">aes</span><span class="op">(</span><span class="va">SnapshotTime</span>, <span class="va">Performance</span>, color<span class="op">=</span><span class="va">PredictorName</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span>size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggtitle</span><span class="op">(</span><span class="st">"Performance over Time"</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-14-1.png" width="480" style="display: block; margin: auto;"></p>
</div>
<div id="binning-evolution" class="section level1">
<h1 class="hasAnchor">
<a href="#binning-evolution" class="anchor"></a>Binning Evolution</h1>
<p>With the detailed binning information available over time, we can show how the binning of a predictor evolves. You see that the number of bins grows as more data becomes available. You also see that this predictor isn’t always active (grey instead of blue).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">binningOverTime</span> <span class="op">&lt;-</span> <span class="va">admdatamart_binning</span><span class="op">[</span><span class="va">PredictorName</span><span class="op">==</span><span class="st">"Customer.Age"</span> <span class="op">&amp;</span> <span class="va">ModelID</span> <span class="op">==</span> <span class="va">model</span><span class="op">$</span><span class="va">ModelID</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>

<span class="fu">grid.arrange</span><span class="op">(</span>grobs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">binningOverTime</span><span class="op">$</span><span class="va">SnapshotTime</span><span class="op">)</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span> 
  <span class="fu"><a href="../reference/plotADMBinning.html">plotADMBinning</a></span><span class="op">(</span><span class="va">binningOverTime</span><span class="op">[</span><span class="va">SnapshotTime</span><span class="op">==</span><span class="va">t</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">ggtitle</span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><img src="adm-datamart_files/figure-html/unnamed-chunk-15-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Otto Perdeck.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
